=======================================================================
LLM Inference Simulator - TP Scaling Benchmark
=======================================================================
Start Time: 2025. 12. 08. (Ïõî) 13:23:23 PST
Random Seed: 18005

‚ö†Ô∏è  Note: Only TP (Tensor Parallelism) is implemented

Configuration:
  Model:           llama2-70b
  xPUs:            a100-80gb h100-80gb mi300x
  Arrival Rate:    10.0 req/s
  Duration:        60.0s

Testing 3 xPUs √ó 4 TP configs = 12 total tests
=======================================================================

-----------------------------------------------------------------------
[1/12] Testing: a100-80gb - TP=1 (expected to fail)
  Cluster: 1 xPUs (TP=1)
-----------------------------------------------------------------------
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/home/deckerd/my_projects/inference_sim/llm_inference_simulator/cli.py", line 219, in <module>
    sys.exit(main())
             ^^^^^^
  File "/home/deckerd/my_projects/inference_sim/llm_inference_simulator/cli.py", line 203, in main
    config = create_config_from_args(args)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/deckerd/my_projects/inference_sim/llm_inference_simulator/cli.py", line 83, in create_config_from_args
    return SimulatorConfig(
           ^^^^^^^^^^^^^^^^
  File "<string>", line 12, in __init__
  File "/home/deckerd/my_projects/inference_sim/llm_inference_simulator/config.py", line 113, in __post_init__
    self.validate()
  File "/home/deckerd/my_projects/inference_sim/llm_inference_simulator/config.py", line 203, in validate
    raise ValueError(error_msg.strip())
ValueError: Configuration validation failed:
  1. Model weights (130.39GB per xPU with TP=1) exceed xPU memory (80.0GB). Increase tensor_parallel_size or use larger xPUs.
‚úó Failed
  Error saved to: results/cluster_benchmark_20251208_132323/a100-80gb_1xpu_tp1.json

-----------------------------------------------------------------------
[2/12] Testing: a100-80gb - TP=2
  Cluster: 2 xPUs (TP=2)
-----------------------------------------------------------------------

Starting simulation...
Starting simulation...
Configuration: LLaMA-2-70B, 2 xPUs, arrival_rate=10.0 req/s
Memory: 65.19GB model, 14.81GB available for KV cache

Simulation completed at t=60.01s

============================================================
SIMULATION SUMMARY
============================================================

Requests:
  Total: 620
  Completed: 61

Throughput:
  Requests/sec: 1.02
  Tokens/sec: 134.28

xPU Utilization: 100.0%

Memory Usage:
  Peak:        79.99GB / 80GB (100.0%)
  P95:         79.95GB / 80GB ( 99.9%)
  P50 (Med):   77.10GB / 80GB ( 96.4%)

First Token Latency (seconds):
  Mean: 26.2477
  P50:  25.7540
  P90:  47.2158
  P95:  47.9505
  P99:  48.2006

End-to-End Latency (seconds):
  Mean: 30.1385
  P50:  30.0668
  P90:  48.2769
  P95:  50.7477
  P99:  51.9260

============================================================

‚úì Results saved to: results/cluster_benchmark_20251208_132323/a100-80gb_2xpu_tp2.json
‚úì Completed successfully
  Throughput: 134.3 tok/s, Completed: 61, P95 TTFT: 47.95s

-----------------------------------------------------------------------
[3/12] Testing: a100-80gb - TP=4
  Cluster: 4 xPUs (TP=4)
-----------------------------------------------------------------------

Starting simulation...
Starting simulation...
Configuration: LLaMA-2-70B, 4 xPUs, arrival_rate=10.0 req/s
Memory: 32.60GB model, 47.40GB available for KV cache

Simulation completed at t=60.02s

============================================================
SIMULATION SUMMARY
============================================================

Requests:
  Total: 620
  Completed: 170

Throughput:
  Requests/sec: 2.83
  Tokens/sec: 384.78

xPU Utilization: 100.0%

Memory Usage:
  Peak:        80.00GB / 80GB (100.0%)
  P95:         79.82GB / 80GB ( 99.8%)
  P50 (Med):   65.16GB / 80GB ( 81.4%)

First Token Latency (seconds):
  Mean: 21.9321
  P50:  20.9331
  P90:  40.7614
  P95:  41.9473
  P99:  42.7934

End-to-End Latency (seconds):
  Mean: 23.2907
  P50:  22.9762
  P90:  39.8841
  P95:  40.5745
  P99:  41.8733

============================================================

‚úì Results saved to: results/cluster_benchmark_20251208_132323/a100-80gb_4xpu_tp4.json
‚úì Completed successfully
  Throughput: 384.8 tok/s, Completed: 170, P95 TTFT: 41.95s

-----------------------------------------------------------------------
[4/12] Testing: a100-80gb - TP=8
  Cluster: 8 xPUs (TP=8)
-----------------------------------------------------------------------

Starting simulation...
Starting simulation...
Configuration: LLaMA-2-70B, 8 xPUs, arrival_rate=10.0 req/s
Memory: 16.30GB model, 63.70GB available for KV cache

Simulation completed at t=60.00s

============================================================
SIMULATION SUMMARY
============================================================

Requests:
  Total: 620
  Completed: 249

Throughput:
  Requests/sec: 4.15
  Tokens/sec: 589.52

xPU Utilization: 100.0%

Memory Usage:
  Peak:        79.92GB / 80GB ( 99.9%)
  P95:         79.88GB / 80GB ( 99.9%)
  P50 (Med):   61.00GB / 80GB ( 76.2%)

First Token Latency (seconds):
  Mean: 16.4079
  P50:  16.8317
  P90:  29.9686
  P95:  31.3160
  P99:  32.8036

End-to-End Latency (seconds):
  Mean: 18.8685
  P50:  18.4375
  P90:  31.3737
  P95:  32.1867
  P99:  33.5748

============================================================

‚úì Results saved to: results/cluster_benchmark_20251208_132323/a100-80gb_8xpu_tp8.json
‚úì Completed successfully
  Throughput: 589.5 tok/s, Completed: 249, P95 TTFT: 31.32s

-----------------------------------------------------------------------
[5/12] Testing: h100-80gb - TP=1 (expected to fail)
  Cluster: 1 xPUs (TP=1)
-----------------------------------------------------------------------
Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "/home/deckerd/my_projects/inference_sim/llm_inference_simulator/cli.py", line 219, in <module>
    sys.exit(main())
             ^^^^^^
  File "/home/deckerd/my_projects/inference_sim/llm_inference_simulator/cli.py", line 203, in main
    config = create_config_from_args(args)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/deckerd/my_projects/inference_sim/llm_inference_simulator/cli.py", line 83, in create_config_from_args
    return SimulatorConfig(
           ^^^^^^^^^^^^^^^^
  File "<string>", line 12, in __init__
  File "/home/deckerd/my_projects/inference_sim/llm_inference_simulator/config.py", line 113, in __post_init__
    self.validate()
  File "/home/deckerd/my_projects/inference_sim/llm_inference_simulator/config.py", line 203, in validate
    raise ValueError(error_msg.strip())
ValueError: Configuration validation failed:
  1. Model weights (130.39GB per xPU with TP=1) exceed xPU memory (80.0GB). Increase tensor_parallel_size or use larger xPUs.
‚úó Failed
  Error saved to: results/cluster_benchmark_20251208_132323/h100-80gb_1xpu_tp1.json

-----------------------------------------------------------------------
[6/12] Testing: h100-80gb - TP=2
  Cluster: 2 xPUs (TP=2)
-----------------------------------------------------------------------

Starting simulation...
Starting simulation...
Configuration: LLaMA-2-70B, 2 xPUs, arrival_rate=10.0 req/s
Memory: 65.19GB model, 14.81GB available for KV cache

Simulation completed at t=60.11s

============================================================
SIMULATION SUMMARY
============================================================

Requests:
  Total: 620
  Completed: 106

Throughput:
  Requests/sec: 1.76
  Tokens/sec: 234.72

xPU Utilization: 100.0%

Memory Usage:
  Peak:        79.99GB / 80GB (100.0%)
  P95:         79.87GB / 80GB ( 99.8%)
  P50 (Med):   76.60GB / 80GB ( 95.7%)

First Token Latency (seconds):
  Mean: 22.2800
  P50:  21.5509
  P90:  40.0002
  P95:  43.8108
  P99:  44.2401

End-to-End Latency (seconds):
  Mean: 25.2198
  P50:  24.8460
  P90:  43.9281
  P95:  47.3611
  P99:  48.6375

============================================================

‚úì Results saved to: results/cluster_benchmark_20251208_132323/h100-80gb_2xpu_tp2.json
‚úì Completed successfully
  Throughput: 234.7 tok/s, Completed: 106, P95 TTFT: 43.81s

-----------------------------------------------------------------------
[7/12] Testing: h100-80gb - TP=4
  Cluster: 4 xPUs (TP=4)
-----------------------------------------------------------------------

Starting simulation...
Starting simulation...
Configuration: LLaMA-2-70B, 4 xPUs, arrival_rate=10.0 req/s
Memory: 32.60GB model, 47.40GB available for KV cache

Simulation completed at t=60.00s

============================================================
SIMULATION SUMMARY
============================================================

Requests:
  Total: 620
  Completed: 319

Throughput:
  Requests/sec: 5.32
  Tokens/sec: 725.61

xPU Utilization: 100.0%

Memory Usage:
  Peak:        80.00GB / 80GB (100.0%)
  P95:         79.21GB / 80GB ( 99.0%)
  P50 (Med):   64.04GB / 80GB ( 80.0%)

First Token Latency (seconds):
  Mean: 13.1278
  P50:  13.8736
  P90:  23.7301
  P95:  24.5951
  P99:  25.6132

End-to-End Latency (seconds):
  Mean: 15.5281
  P50:  15.9583
  P90:  25.7561
  P95:  26.8025
  P99:  28.0836

============================================================

‚úì Results saved to: results/cluster_benchmark_20251208_132323/h100-80gb_4xpu_tp4.json
‚úì Completed successfully
  Throughput: 725.6 tok/s, Completed: 319, P95 TTFT: 24.60s

-----------------------------------------------------------------------
[8/12] Testing: h100-80gb - TP=8
  Cluster: 8 xPUs (TP=8)
-----------------------------------------------------------------------

Starting simulation...
Starting simulation...
Configuration: LLaMA-2-70B, 8 xPUs, arrival_rate=10.0 req/s
Memory: 16.30GB model, 63.70GB available for KV cache

Simulation completed at t=60.02s

============================================================
SIMULATION SUMMARY
============================================================

Requests:
  Total: 620
  Completed: 458

Throughput:
  Requests/sec: 7.63
  Tokens/sec: 1018.85

xPU Utilization: 100.0%

Memory Usage:
  Peak:        79.92GB / 80GB ( 99.9%)
  P95:         79.12GB / 80GB ( 98.9%)
  P50 (Med):   48.47GB / 80GB ( 60.6%)

First Token Latency (seconds):
  Mean: 6.4224
  P50:  6.8017
  P90:  10.2024
  P95:  10.9748
  P99:  12.4961

End-to-End Latency (seconds):
  Mean: 8.6970
  P50:  9.3739
  P90:  12.5786
  P95:  13.1755
  P99:  14.0294

============================================================

‚úì Results saved to: results/cluster_benchmark_20251208_132323/h100-80gb_8xpu_tp8.json
‚úì Completed successfully
  Throughput: 1018.8 tok/s, Completed: 458, P95 TTFT: 10.97s

-----------------------------------------------------------------------
[9/12] Testing: mi300x - TP=1 (expected to fail)
  Cluster: 1 xPUs (TP=1)
-----------------------------------------------------------------------

Starting simulation...
Starting simulation...
Configuration: LLaMA-2-70B, 1 xPUs, arrival_rate=10.0 req/s
Memory: 130.39GB model, 61.61GB available for KV cache

Simulation completed at t=61.82s

============================================================
SIMULATION SUMMARY
============================================================

Requests:
  Total: 620
  Completed: 211

Throughput:
  Requests/sec: 3.41
  Tokens/sec: 451.71

xPU Utilization: 100.0%

Memory Usage:
  Peak:       191.54GB / 192GB ( 99.8%)
  P95:        191.36GB / 192GB ( 99.7%)
  P50 (Med):  171.70GB / 192GB ( 89.4%)

First Token Latency (seconds):
  Mean: 18.6363
  P50:  20.1452
  P90:  32.5211
  P95:  34.2171
  P99:  34.9884

End-to-End Latency (seconds):
  Mean: 22.7937
  P50:  23.3218
  P90:  36.8140
  P95:  38.6869
  P99:  40.8744

============================================================

‚úì Results saved to: results/cluster_benchmark_20251208_132323/mi300x_1xpu_tp1.json
‚úì Completed successfully
  Throughput: 451.7 tok/s, Completed: 211, P95 TTFT: 34.22s

-----------------------------------------------------------------------
[10/12] Testing: mi300x - TP=2
  Cluster: 2 xPUs (TP=2)
-----------------------------------------------------------------------

Starting simulation...
Starting simulation...
Configuration: LLaMA-2-70B, 2 xPUs, arrival_rate=10.0 req/s
Memory: 65.19GB model, 126.81GB available for KV cache

Simulation completed at t=60.02s

============================================================
SIMULATION SUMMARY
============================================================

Requests:
  Total: 620
  Completed: 413

Throughput:
  Requests/sec: 6.88
  Tokens/sec: 914.54

xPU Utilization: 100.0%

Memory Usage:
  Peak:       191.92GB / 192GB (100.0%)
  P95:        191.14GB / 192GB ( 99.6%)
  P50 (Med):  124.96GB / 192GB ( 65.1%)

First Token Latency (seconds):
  Mean: 9.1551
  P50:  9.1566
  P90:  14.3176
  P95:  15.1761
  P99:  16.0602

End-to-End Latency (seconds):
  Mean: 12.2770
  P50:  12.6942
  P90:  17.8323
  P95:  19.2650
  P99:  20.4367

============================================================

‚úì Results saved to: results/cluster_benchmark_20251208_132323/mi300x_2xpu_tp2.json
‚úì Completed successfully
  Throughput: 914.5 tok/s, Completed: 413, P95 TTFT: 15.18s

-----------------------------------------------------------------------
[11/12] Testing: mi300x - TP=4
  Cluster: 4 xPUs (TP=4)
-----------------------------------------------------------------------

Starting simulation...
Starting simulation...
Configuration: LLaMA-2-70B, 4 xPUs, arrival_rate=10.0 req/s
Memory: 32.60GB model, 159.40GB available for KV cache

Simulation completed at t=60.00s

============================================================
SIMULATION SUMMARY
============================================================

Requests:
  Total: 620
  Completed: 554

Throughput:
  Requests/sec: 9.23
  Tokens/sec: 1203.05

xPU Utilization: 100.0%

Memory Usage:
  Peak:       148.02GB / 192GB ( 77.1%)
  P95:        118.24GB / 192GB ( 61.6%)
  P50 (Med):   65.37GB / 192GB ( 34.0%)

First Token Latency (seconds):
  Mean: 3.0523
  P50:  2.9684
  P90:  5.1212
  P95:  5.6639
  P99:  6.5971

End-to-End Latency (seconds):
  Mean: 5.3767
  P50:  5.2512
  P90:  7.9640
  P95:  8.5579
  P99:  9.3678

============================================================

‚úì Results saved to: results/cluster_benchmark_20251208_132323/mi300x_4xpu_tp4.json
‚úì Completed successfully
  Throughput: 1203.1 tok/s, Completed: 554, P95 TTFT: 5.66s

-----------------------------------------------------------------------
[12/12] Testing: mi300x - TP=8
  Cluster: 8 xPUs (TP=8)
-----------------------------------------------------------------------

Starting simulation...
Starting simulation...
Configuration: LLaMA-2-70B, 8 xPUs, arrival_rate=10.0 req/s
Memory: 16.30GB model, 175.70GB available for KV cache

Simulation completed at t=60.00s

============================================================
SIMULATION SUMMARY
============================================================

Requests:
  Total: 620
  Completed: 580

Throughput:
  Requests/sec: 9.67
  Tokens/sec: 1295.55

xPU Utilization: 100.0%

Memory Usage:
  Peak:        76.73GB / 192GB ( 40.0%)
  P95:         65.30GB / 192GB ( 34.0%)
  P50 (Med):   33.11GB / 192GB ( 17.2%)

First Token Latency (seconds):
  Mean: 1.3366
  P50:  1.2713
  P90:  2.4967
  P95:  2.7526
  P99:  3.0809

End-to-End Latency (seconds):
  Mean: 2.5529
  P50:  2.4681
  P90:  3.9245
  P95:  4.4560
  P99:  4.8173

============================================================

‚úì Results saved to: results/cluster_benchmark_20251208_132323/mi300x_8xpu_tp8.json
‚úì Completed successfully
  Throughput: 1295.6 tok/s, Completed: 580, P95 TTFT: 2.75s

=======================================================================
Benchmark Complete!
=======================================================================
End Time: 2025. 12. 08. (Ïõî) 13:23:30 PST

==============================================================================================================
TP SCALING BENCHMARK REPORT
==============================================================================================================

Configuration:
--------------------------------------------------------------------------------------------------------------
  Model:           llama2-70b
  xPUs Tested:     a100-80gb h100-80gb mi300x
  Workload:        10.0 req/s
  Duration:        60.0s

Performance by xPU and TP Configuration:
==============================================================================================================
xPU             #xPUs    TP     Status       Throughput         Completed    P95 TTFT    
--------------------------------------------------------------------------------------------------------------
Error reading results/cluster_benchmark_20251208_132323/a100-80gb_1xpu_tp1.json: Invalid control character at: line 4 column 60 (char 139)
a100-80gb       2        2      ‚úÖ SUCCESS            134.3 tok/s     61/620      47.95s
a100-80gb       4        4      ‚úÖ SUCCESS            384.8 tok/s    170/620      41.95s
a100-80gb       8        8      ‚úÖ SUCCESS            589.5 tok/s    249/620      31.32s
Error reading results/cluster_benchmark_20251208_132323/h100-80gb_1xpu_tp1.json: Invalid control character at: line 4 column 60 (char 139)
h100-80gb       2        2      ‚úÖ SUCCESS            234.7 tok/s    106/620      43.81s
h100-80gb       4        4      ‚úÖ SUCCESS            725.6 tok/s    319/620      24.60s
h100-80gb       8        8      ‚úÖ SUCCESS           1018.8 tok/s    458/620      10.97s
mi300x          1        1      ‚úÖ SUCCESS            451.7 tok/s    211/620      34.22s
mi300x          2        2      ‚úÖ SUCCESS            914.5 tok/s    413/620      15.18s
mi300x          4        4      ‚úÖ SUCCESS           1203.1 tok/s    554/620       5.66s
mi300x          8        8      ‚úÖ SUCCESS           1295.6 tok/s    580/620       2.75s
--------------------------------------------------------------------------------------------------------------

‚úÖ Successful Tests Summary:
--------------------------------------------------------------------------------------------------------------
  üèÜ Best Configuration:
     MI300X with TP=8 (8 xPUs)
     Throughput: 1295.6 tok/s
     Completed: 580/620 (93.5%)

  TP=8 Comparison:
    MI300X              1295.6 tok/s  (2.20x)
    H100-80GB           1018.8 tok/s  (1.73x)
    A100-80GB            589.5 tok/s  (1.00x)

==============================================================================================================
Total: 10 succeeded, 0 failed
==============================================================================================================

Results saved to: results/cluster_benchmark_20251208_132323
=======================================================================
